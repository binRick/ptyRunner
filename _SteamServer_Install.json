
[{"hosts":"steamServers","accelerate":false,"gather_facts":true,"vars":{"processAccounting":1,"ResourceMonitorEnabled":1,"SteamServer":{"IP":"0.0.0.0","SteamUsername":"infinitum123","SteamPassword":"Rapid!23","Email":"rapidvps@gmail.com","EmailNotifications":"on","Game":"arma3","Gibbs":{"Url":"http://danielgibbs.co.uk/dl/","Installer":"arma3server"},"User":{"Name":"arma3server","Home":"/home/arma3server","Shell":"/bin/bash"}}},"tasks":[{"gem":"name={{item}} state=present","with_items":["teamocil"]},{"npm":"name={{item}} state=present global=True","with_items":["prettyjson","underscore-cli"]},{"name":"Deploying Steam required software","yum":"name={{item}} state=present","with_items":["tmux","mailx","postfix","glibc.i686","libstdc++.i686"]},{"name":"Creating Steam User","user":"name={{SteamServer.User.Name}} shell={{SteamServer.User.Shell}} home={{SteamServer.User.Home}} generate_ssh_key=yes ssh_key_bits=2048 ssh_key_file=.ssh/id_rsa"},{"debug":"var={{SteamServer}}"},{"name":"Downloading Gibbs script","get_url":"url={{SteamServer.Gibbs.Url}}{{SteamServer.Gibbs.Installer}} dest={{SteamServer.User.Home}}/{{SteamServer.Gibbs.Installer}}"},{"file":"path={{SteamServer.User.Home}}/{{SteamServer.Gibbs.Installer}} mode=0755 owner={{SteamServer.User.Name}} group={{SteamServer.User.Name}}"},{"file":"path=/root/.ssh/id_rsa.pub mode=0700 owner=root group=root"},{"file":"path=/root/.ssh mode=0700 owner=root group=root"},{"name":"Retrieving root pub key","shell":"cat /root/.ssh/id_rsa.pub 2>/dev/null","register":"rootKey"},{"name":"Adding keys to steam user authorized_keys","authorized_key":"user=\"{{SteamServer.User.Name}}\" key=\"{{ rootKey.stdout }}\" state=present"},{"name":"test local root to user ssh connection","shell":"ssh -o StrictHostKeyChecking=no {{SteamServer.User.Name}}@127.0.0.1 id","register":"userSSHTest"},{"debug":"var=userSSHTest"},{"replace":"dest={{SteamServer.User.Home}}/{{SteamServer.Gibbs.Installer}} regexp='^steamuser=\"(.*)\"$' replace='steamuser=\"{{SteamServer.SteamUsername}}\"'"},{"replace":"dest={{SteamServer.User.Home}}/{{SteamServer.Gibbs.Installer}} regexp='^steampass=\"(.*)\"$' replace='steampass=\"{{SteamServer.SteamPassword}}\"'"},{"replace":"dest={{SteamServer.User.Home}}/{{SteamServer.Gibbs.Installer}} regexp='^ip=\"(.*)\"$' replace='ip=\"{{SteamServer.IP}}\"'"},{"replace":"dest={{SteamServer.User.Home}}/{{SteamServer.Gibbs.Installer}} regexp='^email=\"(.*)\"$' replace='email=\"{{SteamServer.Email}}\"'"},{"replace":"dest={{SteamServer.User.Home}}/{{SteamServer.Gibbs.Installer}} regexp='^emailnotification=\"(.*)\"$' replace='emailnotification=\"{{SteamServer.EmailNotifications|default('off')}}\"'"},{"file":"path=/root/.teamocil mode=0700 owner=root group=root state=directory"}]}]
